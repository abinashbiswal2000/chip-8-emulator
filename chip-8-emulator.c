#include <stdio.h>
#include <stdint.h>

// CPU Class
struct chip8CPU {
    uint8_t ram[4096];  // 4KB memory
    uint16_t pc;        // Program Counter
    uint8_t  V[16];     // General purpose registers V0- V16 ( V0-VF )
    uint16_t I;         // Index register (points to memory addresses)
    uint16_t stack[16]; // Return address stack
    uint8_t  sp;        // Stack pointer
};

// Font Set
uint8_t fontset[80] = {
    0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
    0x20, 0x60, 0x20, 0x20, 0x70, // 1
    0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
    0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
    0x90, 0x90, 0xF0, 0x10, 0x10, // 4
    0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
    0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
    0xF0, 0x10, 0x20, 0x40, 0x40, // 7
    0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
    0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
    0xF0, 0x90, 0xF0, 0x90, 0x90, // A
    0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
    0xF0, 0x80, 0x80, 0x80, 0xF0, // C
    0xE0, 0x90, 0x90, 0x90, 0xE0, // D
    0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
    0xF0, 0x80, 0xF0, 0x80, 0x80  // F
};

int main () {

    struct chip8CPU cpu;

    // A simplified loop for testing
    int running = 1;
    while (running) {
        uint16_t opcode = fetch(&cpu);
        decode_and_execute(&cpu, opcode);

        // Instead of a screen, we use a "Debug Print"
        printf("PC: %04X | Opcode: %04X | V0: %02X | V1: %02X\n", 
                cpu.pc - 2, opcode, cpu.V[0], cpu.V[1]);
                
        // Add a way to stop the loop, or it will run forever!
        if (cpu.pc >= 4096) running = 0;
    }
       
    
    return 0;
}